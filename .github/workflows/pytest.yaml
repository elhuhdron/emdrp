name: Test with pytest

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Modify envrionment.yml for github-actions
      run: |
        sed -i 's+../../+./+g' environment.yml
    - name: Setup Miniconda
      uses: conda-incubator/setup-miniconda@v2.1.1
      with:
          activate-environment: test
          environment-file: ./environment.yml
          auto-activate-base: false
    - name: Test with pytest
      shell: bash -l {0}
      run: |
        conda activate test && conda env list && ${CONDA}/envs/test/bin/pytest
